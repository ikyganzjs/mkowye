<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title id="pageTitle">API Docs</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<style>
:root{
--bg-light:#f4f5f7;--bg-dark:#0d1117;
--glass-light:rgba(255,255,255,.5);--glass-dark:rgba(255,255,255,.06);
--border-light:rgba(0,0,0,.08);--border-dark:rgba(255,255,255,.08);
--text-dark:#1f1f1f;--text-light:#e5e5e5;
--primary:#3B82F6;
--transition:.25s ease;
}

body{
margin:0;padding:0;background:var(--bg-light);
font-family:'Poppins',sans-serif;transition:var(--transition);}
body.dark{background:var(--bg-dark);color:var(--text-light);}

#loading-screen{
position:fixed;top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,.4);backdrop-filter:blur(12px);
display:flex;flex-direction:column;align-items:center;justify-content:center;
color:white;font-size:1.2rem;z-index:9999;
}
.loader{width:40px;height:40px;border:4px solid rgba(255,255,255,.3);
border-top:4px solid white;border-radius:50%;animation:spin .8s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}

/* NAV */
nav{
background:var(--glass-light);backdrop-filter:blur(12px);
border-bottom:1px solid var(--border-light);padding:1rem 2rem;
display:flex;justify-content:space-between;align-items:center;
position:sticky;top:0;z-index:50;transition:var(--transition);
}
body.dark nav{background:var(--glass-dark);border-color:var(--border-dark);}
.brand{display:flex;align-items:center;gap:10px;font-size:1.4rem;font-weight:600;}
.logo{width:40px;height:40px;border-radius:50%;object-fit:cover;}

/* MAIN */
.container{max-width:950px;margin:1.7rem auto;padding:0 1rem;}
.stats{display:flex;gap:10px;flex-wrap:wrap;margin-top:20px;}
.stat-box{
flex:1;min-width:140px;padding:15px;border-radius:12px;text-align:center;
background:var(--glass-light);border:1px solid var(--border-light);
backdrop-filter:blur(10px);transition:var(--transition);
}
body.dark .stat-box{background:var(--glass-dark);border-color:var(--border-dark);}

.api-key-box{
flex-basis:100%;max-width:100%;
padding:15px;margin-top:-5px;text-align:center;
background:var(--glass-light);border-radius:12px;border:1px solid var(--border-light);
font-size:1.05rem;font-weight:600;
}
body.dark .api-key-box{background:var(--glass-dark);border-color:var(--border-dark);}

.tabs{display:flex;gap:8px;overflow-x:auto;margin:18px 0;}
.tab{
padding:8px 15px;border-radius:8px;background:none;
cursor:pointer;white-space:nowrap;
border:1px solid transparent;font-weight:500;
}
.tab.active{background:var(--primary);color:white;}

.api-list{display:grid;grid-template-columns:1fr;gap:15px;}
.api-card{
padding:1rem;border-radius:12px;background:var(--glass-light);
border:1px solid var(--border-light);backdrop-filter:blur(8px);
transition:var(--transition);}
body.dark .api-card{background:var(--glass-dark);border-color:var(--border-dark);}
.api-card:hover{transform:translateY(-3px);}
.method{padding:3px 8px;background:var(--primary);color:white;font-size:.7rem;border-radius:6px;}

.play{margin-top:10px;background:var(--primary);color:white;border:none;
padding:8px 14px;border-radius:8px;cursor:pointer;}

#modal{
position:fixed;top:0;left:0;width:100%;height:100%;display:none;
background:rgba(0,0,0,.5);backdrop-filter:blur(12px);
align-items:center;justify-content:center;padding:1rem;z-index:999;
}
.modal-box{
width:100%;max-width:500px;padding:1.5rem;border-radius:15px;
background:var(--glass-light);border:1px solid var(--border-light);
backdrop-filter:blur(20px);transition:.3s;}
body.dark .modal-box{background:var(--glass-dark);border-color:var(--border-dark);}
input{
width:100%;padding:.8rem;border-radius:10px;margin-bottom:.9rem;
border:1px solid var(--border-light);background:rgba(255,255,255,.1);
}
body.dark input{background:rgba(255,255,255,.07);color:white;border-color:var(--border-dark);}

#response{
margin-top:1rem;padding:1rem;border-radius:8px;
background:rgba(0,0,0,.07);max-height:280px;overflow:auto;
}
body.dark #response{background:rgba(255,255,255,.08);}

/* COPY BUTTON */
.copy-btn{
margin-top:8px;background:#2563eb;color:white;border:none;
padding:8px 12px;border-radius:6px;cursor:pointer;font-size:.8rem;
}
</style>
</head>
<body>

<div id="loading-screen"><div class="loader"></div>Memuat...</div>

<nav>
<div class="brand">
<img id="logo" class="logo" src="https://i.ibb.co/C99c0bN/cloud-logo.png">
<span id="navName">REST API</span>
</div>
<div style="display:flex;align-items:center;gap:20px;">
<div id="clock"></div>
<i id="themeToggle" class="fas fa-moon" style="cursor:pointer;"></i>
</div>
</nav>

<div class="container">
<h1 id="apiTitle"></h1>
<p style="opacity:.7">Dosc IkyApi'S</p>

<div class="stats">
<div class="stat-box">Kategori<br><b id="statCat">0</b></div>
<div class="stat-box">Endpoint<br><b id="statEnd">0</b></div>
<div class="stat-box">Status<br><b style="color:#4ade80">Online</b></div>
<div class="stat-box">Ping<br><b id="statPing">0ms</b></div>
<div class="api-key-box">APIKEY : <b>IkyPrem</b></div>
</div>

<div class="tabs" id="tabs"></div>
<div class="api-list" id="apiList"></div>
</div>

<div id="modal">
<div class="modal-box">
<span style="float:right;font-size:1.8rem;cursor:pointer;" onclick="closeModal()">&times;</span>
<h3 id="mTitle"></h3>
<p id="mDesc" style="opacity:.7;margin-top:-5px;"></p>

<div id="paramBox"></div>
<button id="send" style="width:100%;padding:.8rem;background:var(--primary);color:white;border:none;border-radius:8px;display:none;">Kirim Respon</button>

<div id="response"></div>
<button id="copyResult" class="copy-btn" style="display:none;">Salin Hasil</button>
</div>
</div>

<script>
/* Clock */
function clock(){document.getElementById("clock").textContent=new Date().toLocaleTimeString();}
setInterval(clock,1000);clock();

/* Dark Mode */
const tg=document.getElementById("themeToggle");
tg.onclick=()=>{document.body.classList.toggle("dark");tg.classList.toggle("fa-sun");localStorage.setItem("theme",document.body.classList.contains("dark"))};
if(localStorage.getItem("theme")==="true"){document.body.classList.add("dark");tg.classList.replace("fa-moon","fa-sun");}

let settings={},apis={};

/* Load API Data */
async function load(){
try{
settings=await fetch("/set").then(r=>r.json());
apis=await fetch("/endpoints").then(r=>r.json());

document.getElementById("loading-screen").style.display="none";
document.getElementById("navName").textContent=settings.apiTitle;
document.getElementById("apiTitle").textContent=settings.apiTitle;
if(settings.logo)document.getElementById("logo").src=settings.logo;

let c=Object.keys(apis);
document.getElementById("statCat").textContent=c.length;
document.getElementById("statEnd").textContent=Object.values(apis).flat().length;

renderTabs(c);
ping();
}catch(e){alert("Gagal memuat API");}
}
load();

/* Ping */
async function ping(){
let t=performance.now();
await fetch("/set");
let ms=Math.round(performance.now()-t);
document.getElementById("statPing").textContent=ms+"ms";
}

/* Tabs */
function renderTabs(c){
let t=document.getElementById("tabs");t.innerHTML="";
c.forEach((x,i)=>{
let tab=document.createElement("div");
tab.className="tab"+(i===0?" active":"");
tab.textContent=x;
tab.onclick=()=>selectTab(x,tab);
t.appendChild(tab);
});
selectTab(c[0]);
}

function selectTab(cat,el){
document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
if(el)el.classList.add("active");
renderList(cat);
}

/* List */
function renderList(cat){
let list=document.getElementById("apiList");list.innerHTML="";
apis[cat].forEach(api=>{
let div=document.createElement("div");
div.className="api-card";
div.innerHTML=`
<div class="method">GET</div>
<h3>${api.name}</h3>
<p style="opacity:.7">${api.desc||""}</p>
<button class="play">Coba â–¶</button>`;
div.querySelector(".play").onclick=()=>openModal(api);
list.appendChild(div);
});
}

/* Modal */
function openModal(api){
document.getElementById("modal").style.display="flex";
document.getElementById("mTitle").textContent=api.name;
document.getElementById("mDesc").textContent=api.desc||"";
let box=document.getElementById("paramBox");box.innerHTML="";
let send=document.getElementById("send");send.style.display="none";
document.getElementById("copyResult").style.display="none";
document.getElementById("response").innerHTML="";

if(api.path.includes("?")){
send.style.display="block";
api.path.split("?")[1].split("&").forEach(p=>{
let k=p.split("=")[0];
box.innerHTML+=`<input id="p_${k}" placeholder="${k}" required/>`;
});
send.onclick=()=>request(api);
}else request(api);
}

function closeModal(){
document.getElementById("modal").style.display="none";
}

/* Request */
async function request(api){
let path=api.path;
if(path.includes("?")){
let base=path.split("?")[0]+"?";
let arr=path.split("?")[1].split("&");
arr.forEach((a,i)=>{
let k=a.split("=")[0];
base+=k+"="+encodeURIComponent(document.getElementById("p_"+k).value)+(i<arr.length-1?"&":"");
});
path=base;
}

let url=location.origin+path;
let out=document.getElementById("response");
out.innerHTML="Loading...";
document.querySelector(".modal-box").scrollTo({top:9999,behavior:"smooth"});

try{
let r=await fetch(url);
let t=await r.text();
try{
out.textContent=JSON.stringify(JSON.parse(t),null,2);
}catch{
out.textContent=t;
}
document.getElementById("copyResult").style.display="block";
document.getElementById("copyResult").onclick=()=>navigator.clipboard.writeText(out.textContent);
}catch(e){
out.textContent="Error: "+e;
}
}
</script>
</body>
</html>
